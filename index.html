<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Market Terminal | Full History Analysis</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Assistant:wght@200;400;700;800&family=JetBrains+Mono&display=swap');
        body { background-color: #050508; color: #e2e8f0; font-family: 'Assistant', sans-serif; }
        .glass-panel { background: rgba(20, 20, 28, 0.8); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.05); }
        .mono { font-family: 'JetBrains Mono', monospace; }
        .chart-container { height: 500px; position: relative; }
    </style>
</head>
<body class="p-4 md:p-8">
    <div class="max-w-7xl mx-auto">
        <!-- Header -->
        <header class="flex flex-col md:flex-row justify-between items-center mb-8 gap-6 glass-panel p-6 rounded-[2rem]">
            <div class="flex items-center gap-4">
                <div class="w-12 h-12 bg-emerald-600 rounded-xl flex items-center justify-center shadow-lg"><i class="fas fa-database text-white text-2xl"></i></div>
                <div>
                    <h1 class="text-2xl font-black uppercase tracking-tight">Market <span class="text-emerald-500">Archive</span></h1>
                    <p class="text-[10px] text-slate-500 uppercase font-bold tracking-widest">Full Historical Analysis Engine</p>
                </div>
            </div>

            <div class="flex items-center gap-4">
                <select id="ticker-select" onchange="loadData(this.value)" class="bg-[#1a1a24] text-white px-6 py-2.5 rounded-xl font-black text-sm outline-none border border-emerald-900/50">
                    <option value="nvda">NVIDIA (NVDA)</option>
                    <option value="aapl">APPLE (AAPL)</option>
                    <option value="msft">MICROSOFT (MSFT)</option>
                    <option value="googl">ALPHABET (GOOGL)</option>
                    <option value="amzn">AMAZON (AMZN)</option>
                    <option value="meta">META (META)</option>
                    <option value="tsla">TESLA (TSLA)</option>
                    <option value="brk-b">BERKSHIRE (BRK-B)</option>
                    <option value="lly">ELI LILLY (LLY)</option>
                    <option value="avgo">BROADCOM (AVGO)</option>
                </select>
            </div>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
            <!-- Sidebar -->
            <div class="lg:col-span-3 space-y-6">
                <div id="signal-card" class="glass-panel p-8 rounded-[2rem] text-center">
                    <div class="text-[10px] font-bold text-slate-500 uppercase mb-4 tracking-widest">System Signal</div>
                    <div id="signal-text" class="text-6xl font-black mb-2 italic">---</div>
                    <div id="signal-desc" class="text-xs text-slate-400">Loading history...</div>
                </div>

                <div class="glass-panel p-6 rounded-[2rem] space-y-4">
                    <div class="flex justify-between border-b border-white/5 pb-2">
                        <span class="text-xs text-slate-500">מחיר נוכחי</span>
                        <b id="price" class="mono">---</b>
                    </div>
                    <div class="flex justify-between border-b border-white/5 pb-2">
                        <span class="text-xs text-slate-500">הנפקה ראשונה</span>
                        <b id="first-date" class="mono text-[10px]">---</b>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-xs text-slate-500">RSI</span>
                        <b id="rsi-val" class="mono">---</b>
                    </div>
                </div>
            </div>

            <!-- Chart -->
            <div class="lg:col-span-9 glass-panel p-8 rounded-[3rem]">
                <div class="flex justify-between items-center mb-6">
                    <h2 id="comp-name" class="text-xl font-black text-white">---</h2>
                    <span class="text-[9px] bg-emerald-500/10 text-emerald-500 px-3 py-1 rounded-full font-bold">ALL-TIME DATASET</span>
                </div>
                <div class="chart-container">
                    <canvas id="fullChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <script>
        let fullChart = null;

        async function loadData(symbol) {
            try {
                const res = await fetch(`data/${symbol}_data.json?v=${Date.now()}`);
                const data = await res.json();
                updateUI(data);
            } catch (e) {
                alert("קובץ נתונים לא נמצא. וודא שה-Action בגיטהאב רץ בהצלחה.");
            }
        }

        function updateUI(data) {
            const m = data.metadata;
            const h = data.history;

            document.getElementById('comp-name').innerText = m.name;
            document.getElementById('price').innerText = `$${m.current_price.toLocaleString()}`;
            document.getElementById('rsi-val').innerText = m.rsi.toFixed(2);
            document.getElementById('first-date').innerText = m.first_trade_date;

            // Signal Logic
            const sig = document.getElementById('signal-text');
            const desc = document.getElementById('signal-desc');
            if(m.rsi < 35) {
                sig.innerText = "BUY"; sig.className = "text-6xl font-black mb-2 text-emerald-500 italic";
                desc.innerText = "המניה בשפל היסטורי ביחס לתקופה האחרונה.";
            } else if(m.rsi > 70) {
                sig.innerText = "SELL"; sig.className = "text-6xl font-black mb-2 text-rose-500 italic";
                desc.innerText = "המניה בשיא כוחה, ייתכן תיקון טכני.";
            } else {
                sig.innerText = "HOLD"; sig.className = "text-6xl font-black mb-2 text-slate-500 italic";
                desc.innerText = "המניה שומרת על יציבות בתוך המגמה.";
            }

            renderChart(h, m.symbol);
        }

        function renderChart(history, symbol) {
            const ctx = document.getElementById('fullChart').getContext('2d');
            if(fullChart) fullChart.destroy();

            fullChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: history.map(row => row.Datetime),
                    datasets: [
                        {
                            label: 'Price',
                            data: history.map(row => row.Close),
                            borderColor: '#10b981',
                            borderWidth: 1.5,
                            pointRadius: 0, // חובה לביצועים בנתוני עתק
                            fill: true,
                            backgroundColor: 'rgba(16, 185, 129, 0.05)',
                            tension: 0.1
                        },
                        {
                            label: 'SMA200',
                            data: history.map(row => row.SMA200),
                            borderColor: '#f59e0b',
                            borderWidth: 1,
                            pointRadius: 0,
                            fill: false,
                            borderDash: [5, 5]
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: { display: false },
                        y: { 
                            grid: { color: 'rgba(255,255,255,0.03)' },
                            ticks: { color: '#64748b', font: { size: 10 } }
                        }
                    },
                    plugins: {
                        legend: { display: false },
                        tooltip: { mode: 'index', intersect: false }
                    }
                }
            });
        }

        window.onload = () => loadData('nvda');
    </script>
</body>
</html>
