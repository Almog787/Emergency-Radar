<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>High-Frequency Market Terminal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Assistant:wght@400;700;800&display=swap');
        body { font-family: 'Assistant', sans-serif; background-color: #000; color: #fff; }
        .card { background: #111; border: 1px solid #222; }
    </style>
</head>
<body class="p-4">
    <div class="max-w-7xl mx-auto">
        <!-- Header -->
        <div class="flex justify-between items-center mb-6 bg-[#16161d] p-4 rounded-2xl">
            <h1 class="text-xl font-black uppercase tracking-tight">Intraday <span class="text-emerald-500">Terminal</span></h1>
            <select id="ticker-select" onchange="loadData(this.value)" class="bg-[#1a1a24] text-white px-4 py-2 rounded-xl font-bold">
                <option value="nvda">NVIDIA</option>
                <option value="aapl">APPLE</option>
                <option value="msft">MICROSOFT</option>
            </select>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
            <!-- Signal -->
            <div class="lg:col-span-1 card p-6 rounded-2xl text-center">
                <div class="text-[10px] text-slate-500 uppercase font-bold mb-4">Real-Time Signal (1m RSI)</div>
                <div id="signal-text" class="text-5xl font-black mb-2 italic">---</div>
                <div class="flex justify-between mt-6 pt-6 border-t border-white/10">
                    <span class="text-xs text-slate-400">מחיר:</span><b id="price">---</b>
                </div>
                <div class="flex justify-between mt-2">
                    <span class="text-xs text-slate-400">RSI:</span><b id="rsi-val">---</b>
                </div>
            </div>

            <!-- Chart -->
            <div class="lg:col-span-3 card p-6 rounded-2xl">
                <h2 id="comp-name" class="text-lg font-bold mb-4 text-emerald-400">---</h2>
                <div class="h-[450px]"><canvas id="mainChart"></canvas></div>
            </div>
        </div>
    </div>

    <script>
        let myChart = null;

        async function loadData(symbol) {
            try {
                const res = await fetch(`data/${symbol}_intraday_data.json?v=${Date.now()}`);
                const data = await res.json();
                updateUI(data);
            } catch (e) {
                // Handle error
            }
        }

        function updateUI(data) {
            const m = data.metadata;
            const h = data.history;

            document.getElementById('comp-name').innerText = m.name;
            document.getElementById('price').innerText = `$${m.current_price.toFixed(2)}`;
            document.getElementById('rsi-val').innerText = m.rsi.toFixed(2);

            // Signal
            const sig = document.getElementById('signal-text');
            if(m.rsi < 30) { sig.innerText = "BUY"; sig.className = "text-5xl font-black text-emerald-500 italic"; }
            else if(m.rsi > 70) { sig.innerText = "SELL"; sig.className = "text-5xl font-black text-rose-500 italic"; }
            else { sig.innerText = "HOLD"; sig.className = "text-5xl font-black text-slate-500 italic"; }

            renderChart(h.slice(-500)); // הצגת 500 הדקות האחרונות
        }

        function renderChart(history) {
            const ctx = document.getElementById('mainChart').getContext('2d');
            if(myChart) myChart.destroy();
            
            myChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: history.map(row => row.Datetime),
                    datasets: [{
                        label: 'Price',
                        data: history.map(row => row.Close),
                        borderColor: '#10b981',
                        borderWidth: 1.5,
                        pointRadius: 0
                    }]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    scales: {
                        x: { type: 'time', time: { unit: 'hour' }, display: true, ticks: { color: '#666' } },
                        y: { grid: { color: '#222' }, ticks: { color: '#888' } }
                    },
                    plugins: { legend: { display: false } }
                }
            });
        }

        window.onload = () => loadData('nvda');
    </script>
</body>
</html>
